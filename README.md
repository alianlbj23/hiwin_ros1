# HIWIN ROS MoveIt IK JSON ä»‹é¢

æ­¤ ROS package æä¾›ä¸€å€‹é€é JSON æ ¼å¼æ§åˆ¶ HIWIN æ©Ÿæ¢°æ‰‹è‡‚çš„æµç¨‹ã€‚å®ƒåŒ…å«å…©å€‹ä¸»è¦ç¯€é»ï¼šä¸€å€‹æ˜¯äº’å‹•å¼å‘½ä»¤åˆ—å·¥å…·ï¼Œç”¨æ–¼ç™¼é€ç›®æ¨™é»å’Œæ§åˆ¶ä¿¡è™Ÿï¼›å¦ä¸€å€‹æ˜¯æ ¸å¿ƒçš„ IK é‹ç®—ç¯€é»ï¼Œå®ƒæ ¹æ“šæ”¶åˆ°çš„ä¿¡è™ŸåŸ·è¡Œé€†å‘é‹å‹•å­¸ï¼ˆIKï¼‰è¨ˆç®—ä¸¦ç™¼å¸ƒé—œç¯€è§’åº¦ã€‚

æ­¤ç³»çµ±æ¡ç”¨ä¸€å€‹ç°¡å–®çš„ç‹€æ…‹æ©Ÿä¾†ç®¡ç†æµç¨‹ï¼š`IDLE` -> `GOT_POINTS` -> `PLANNED`ã€‚

---

## ğŸ“¦ ç¯€é» (Nodes)

### `signal_publisher_node.py`

é€™æ˜¯ä¸€å€‹å‘½ä»¤åˆ—ä»‹é¢çš„æ¸¬è©¦å·¥å…·ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥æ‰‹å‹•è§¸ç™¼æµç¨‹ä¸­çš„å„å€‹æ­¥é©Ÿã€‚

-   **åŠŸèƒ½:**
    1.  ç™¼é€ä¸€çµ„å›ºå®šçš„ 3D åº§æ¨™é» (JSON æ ¼å¼) åˆ° `/target_points_json` topicã€‚
    2.  ç™¼é€æ§åˆ¶ä¿¡è™Ÿ (`plan`, `execute`, `stop`) åˆ° `/robot_signal` topicã€‚
-   **ç™¼å¸ƒ (Publishes to):**
    -   `/target_points_json` (`std_msgs/String`)
    -   `/robot_signal` (`std_msgs/String`)

---

### `hiwin_moveit_node_re.py`

é€™æ˜¯è™•ç† IK é‹ç®—å’Œç‹€æ…‹ç®¡ç†çš„æ ¸å¿ƒç¯€é»ã€‚

1.  **ç­‰å¾…åº§æ¨™é»:** è¨‚é–± `/target_points_json`ã€‚æ”¶åˆ° JSON æ ¼å¼çš„é»ä½å¾Œï¼Œç«‹å³ç‚ºæ‰€æœ‰é»ä½è¨ˆç®— IKã€‚
    -   è‹¥ä»»ä¸€é»ä½ IK è¨ˆç®—å¤±æ•—ï¼Œç™¼å¸ƒå¤±æ•—è¨Šæ¯è‡³ `/target_points_joints_json_tmp` ä¸¦é‡ç½®æµç¨‹ã€‚
    -   è‹¥å…¨éƒ¨æˆåŠŸï¼Œå°‡è¨ˆç®—çµæœ (é—œç¯€è§’åº¦) æš«å­˜èµ·ä¾†ï¼Œä¸¦é€²å…¥ `GOT_JSON` ç‹€æ…‹ã€‚
2.  **ç­‰å¾… Plan æŒ‡ä»¤:** è¨‚é–± `/robot_signal`ã€‚ç•¶æ”¶åˆ° `plan` æŒ‡ä»¤æ™‚ï¼š
    -   ç™¼å¸ƒæš«å­˜çš„é—œç¯€è§’åº¦åˆ° `/target_points_joints_json_tmp` ä½œç‚ºé è¦½ã€‚
    -   é€²å…¥ `PLANNED` ç‹€æ…‹ã€‚
3.  **ç­‰å¾… Execute æŒ‡ä»¤:** ç•¶æ”¶åˆ° `execute` æŒ‡ä»¤æ™‚ï¼š
    -   ç™¼å¸ƒæš«å­˜çš„é—œç¯€è§’åº¦åˆ° `/target_points_joints_json` ä½œç‚ºæœ€çµ‚åŸ·è¡Œçš„ç›®æ¨™ã€‚
    -   é‡ç½®æµç¨‹ï¼Œå›åˆ°åˆå§‹ç‹€æ…‹ç­‰å¾…æ–°çš„åº§æ¨™é»ã€‚
4.  **Stop æŒ‡ä»¤:** ä»»ä½•æ™‚å€™æ”¶åˆ° `stop` æŒ‡ä»¤ï¼Œéƒ½æœƒç«‹å³ä¸­æ–·ç•¶å‰æµç¨‹ä¸¦é‡ç½®ç‹€æ…‹ã€‚

#### è¡Œç‚ºæ‘˜è¦

| ç›®å‰ç‹€æ…‹         | æ”¶åˆ°ä¿¡è™Ÿ (`/robot_signal`) | åŸ·è¡Œå‹•ä½œ                                                               | æ–°ç‹€æ…‹           |
| ---------------- | -------------------------- | ---------------------------------------------------------------------- | ---------------- |
| `IDLE`           | (æ”¶åˆ° `/target_points_json`) | è¨ˆç®—æ‰€æœ‰é»çš„ IKã€‚è‹¥æˆåŠŸï¼Œæš«å­˜çµæœã€‚                                    | `GOT_JSON`       |
| `GOT_JSON`       | `plan`                     | ç™¼å¸ƒé—œç¯€è§’åº¦åˆ° `/target_points_joints_json_tmp`ã€‚                        | `PLANNED`        |
| `PLANNED`        | `execute`                  | ç™¼å¸ƒé—œç¯€è§’åº¦åˆ° `/target_points_joints_json`ï¼Œç„¶å¾Œé‡ç½®ã€‚                  | `IDLE`           |
| ä»»ä½•ç‹€æ…‹         | `stop`                     | é‡ç½®æ‰€æœ‰ç‹€æ…‹èˆ‡æš«å­˜è³‡æ–™ã€‚                                               | `IDLE`           |

-   **è¨‚é–± (Subscribes to):**
    -   `/target_points_json` (`std_msgs/String`)
    -   `/robot_signal` (`std_msgs/String`)
-   **ç™¼å¸ƒ (Publishes to):**
    -   `/target_points_joints_json_tmp` (`std_msgs/String`): IK é‹ç®—çµæœé è¦½ã€‚
    -   `/target_points_joints_json` (`std_msgs/String`): æœ€çµ‚ç¢ºèªè¦åŸ·è¡Œçš„é—œç¯€ç›®æ¨™ã€‚
-   **ä½¿ç”¨æœå‹™ (Uses Service):**
    -   `/compute_ik` (`moveit_msgs/GetPositionIK`)

---

## ğŸ”§ ä¾è³´é … (Dependencies)

-   `rospy`
-   `moveit_ros_planning_interface`
-   `std_msgs`
-   `moveit_msgs`

*æ³¨æ„ï¼šæ­¤ç‰ˆæœ¬ä½¿ç”¨ `std_msgs/String` å‚³é JSONï¼Œä¸å†éœ€è¦è‡ªå®šç¾©è¨Šæ¯ (`custom_msgs`)ã€‚*

---

## â–¶ï¸ å¦‚ä½•åŸ·è¡Œ

1.  **å•Ÿå‹•æ©Ÿæ¢°æ‰‹è‡‚çš„ MoveIt ç’°å¢ƒã€‚**  
    é€™æœƒå•Ÿå‹•å¿…è¦çš„æœå‹™ï¼ŒåŒ…å« `/compute_ik`ã€‚

    ```bash
    # ä»¥æ‚¨è‡ªå·±çš„å•Ÿå‹•æª”æ¡ˆå–ä»£
    roslaunch my_hiwin_pkg demo.launch
    ```

2.  **åœ¨ä¸€å€‹çµ‚ç«¯æ©Ÿä¸­ï¼ŒåŸ·è¡Œ IK æ ¸å¿ƒç¯€é»ã€‚**  
    æ­¤ç¯€é»æœƒé–‹å§‹ç­‰å¾…ä¾†è‡ª `/target_points_json` çš„åº§æ¨™é»ã€‚

    ```bash
    rosrun my_hiwin_pkg hiwin_moveit_node_re.py
    ```

3.  **åœ¨å¦ä¸€å€‹çµ‚ç«¯æ©Ÿä¸­ï¼ŒåŸ·è¡Œäº’å‹•å¼å‘½ä»¤ç¯€é»ã€‚**

    ```bash
    rosrun my_hiwin_pkg signal_publisher_node.py
    ```

4.  **ä¾ç…§  çš„æç¤ºæ“ä½œï¼š**
    1.  è¼¸å…¥ `1` ç™¼é€ç›®æ¨™é»ã€‚
    2.  è¼¸å…¥ `2` ç™¼é€ `plan` ä¿¡è™Ÿï¼Œè§¸ç™¼ IK çµæœé è¦½ã€‚
    3.  è¼¸å…¥ `3` ç™¼é€ `execute` ä¿¡è™Ÿï¼Œç™¼å¸ƒæœ€çµ‚é—œç¯€ç›®æ¨™ã€‚
    4.  å¯éš¨æ™‚è¼¸å…¥ `4` (`stop`) ä¾†é‡ç½®æµç¨‹ã€‚

5.  **(å¯é¸) åœ¨å…¶ä»–çµ‚ç«¯æ©Ÿä¸­ç›£æ§ Topicsï¼š**

    ```bash
    # ç›£æ§ IK é è¦½çµæœ
    rostopic echo /target_points_joints_json_tmp

    # ç›£æ§æœ€çµ‚åŸ·è¡Œçš„é—œç¯€ç›®æ¨™
    rostopic echo /target_points_joints_json
    ```

---

## ğŸ§ª JSON è¨Šæ¯æ ¼å¼ç¯„ä¾‹

### `/target_points_json` (ç™¼é€)

```json
{
  "points": [
    {"x": -0.499, "y": 0.876, "z": 0.796},
    {"x": -0.070, "y": 0.808, "z": 0.988}
  ]
}